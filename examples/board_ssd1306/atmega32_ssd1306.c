/*
	atmega48_charlcd.c

	Copyright Luki <humbell@ethz.ch>
	Copyright 2011 Michel Pollet <buserror@gmail.com>

 	This file is part of simavr.

	simavr is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	simavr is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with simavr.  If not, see <http://www.gnu.org/licenses/>.
 */

#include <avr/io.h>
#include <util/delay.h>
#include <avr/pgmspace.h>

#include "avr_mcu_section.h"
AVR_MCU(F_CPU, "atmega32");

#include "ssd1306.c"

const uint8_t LOGO[] PROGMEM = {
0x0,0x0,0x53,0x60,0xe0,0xe0,0x3,0xf0,0xf8,0xfe,0xff,0xf8,0xf0,0xe0,0xe0,0x3,0x60,0x0,0x0,0x26,0x80,0x80,0x4,0xc0,0xe0,0xf8,0xfc,0xe0,0xc0,0x80,0x80,0x4,0x0,0x0,0x1f,0x80,0xc0,0x0,0x0,0x1f,0x61,0x3f,0x1f,0x1f,0x2,0xf,0xf,0x2,0x1f,0x3f,0x3f,0x2,0x61,0x0,0x0,0x28,0x1,0x3,0x87,0xff,0x7f,0x7f,0x2,0x3f,0x3f,0x2,0x7f,0xff,0xff,0x2,0x87,0x3,0x1,0x0,0x0,0x19,0x18,0x38,0x78,0xf8,0xfc,0xfe,0xff,0xff,0x2,0xfe,0xfc,0xf8,0x78,0x38,0x18,0x0,0x0,0x35,0x80,0xc0,0x0,0x0,0x16,0x1,0x0,0x0,0x8,0x1,0x0,0x0,0xc,0x10,0xf0,0x0,0x0,0xf,0x18,0xf,0x7,0x7,0x2,0x3,0x3,0x2,0x7,0xf,0xf,0x2,0x18,0x0,0x0,0x14,0x10,0xf0,0x0,0x0,0x1b,0x18,0x38,0x78,0xf8,0xfc,0xfe,0xff,0xff,0x2,0xfe,0xfc,0xf8,0x78,0x38,0x18,0x0,0x0,0xb,0x3e,0x61,0x41,0x41,0x2,0x43,0x0,0x0,0x2,0x3e,0x41,0x41,0x4,0x3e,0x0,0x0,0x2,0x1,0x7,0x3d,0x60,0x10,0x6,0xe,0x38,0x60,0x18,0x2,0x0,0x0,0x2,0x7f,0x42,0x41,0x41,0x3,0x23,0x1e,0x0,0x0,0x2,0x3e,0x41,0x41,0x4,0x3e,0x0,0x0,0x2,0x1,0x3,0xf,0xf0,0x60,0x8,0x3,0x1,0x0,0x3e,0x61,0x41,0x41,0x2,0x43,0x0,0x0,0x2,0x3e,0x41,0x41,0x4,0x3e,0x0,0x0,0x3,0x3e,0x63,0x41,0x41,0x2,0x1,0x7f,0x40,0x0,0x0,0x2,0x3e,0x65,0x45,0x45,0x3,0x26,0x0,0x0,0x2,0x41,0x7f,0x42,0x3,0x1,0x0,0x66,0x4d,0x49,0x59,0x30,0x0,0x0,0x7,0x18,0xf,0x7,0x7,0x2,0x3,0x3,0x2,0x7,0xf,0xf,0x2,0x18,0x0,0x0,0x22,0x80,0xc0,0x0,0x0,0x17,0x2,0x2,0x2,0x1,0x0,0x0,0x21,0x80,0xc0,0x0,0x0,0x3b,0x18,0x38,0x78,0xf8,0xfc,0xfe,0xff,0xff,0x2,0xfe,0xfc,0xf8,0x78,0x38,0x18,0x0,0x0,0x2f,0x18,0x38,0x78,0xf8,0xfc,0xfe,0xff,0xff,0x2,0xfe,0xfc,0xf8,0x78,0x38,0x18,0x0,0x0,0x16,0x80,0xc0,0xf0,0xf8,0xc0,0x80,0x0,0x0,0x1b,0x18,0xf,0x7,0x7,0x2,0x3,0x3,0x2,0x7,0xf,0xf,0x2,0x18,0x0,0x0,0x33,0x18,0xf,0x7,0x7,0x2,0x3,0x3,0x2,0x7,0xf,0xf,0x2,0x18,0x0,0x0,0x14,0x3,0x7,0xf,0xff,0xff,0x3,0x7f,0x7f,0x2,0xff,0xff,0x3,0xf,0x7,0x3};

void
spi_init (void)
{
  // Configure pins
  DDRB |= (1 << PB4) | (1 << PB5) | (1 << PB7) | (1 << PB3) | (1 << PB1);// Set MOSI , SCK , and SS output
  // Enable SPI, Master, set clock rate fck/2
  SPCR |= (1 << SPE) | (1 << MSTR);
  // 1 = Double the speed: minimum SCK == 2 clock periods
  SPSR |= (1 << SPI2X);
}

int
main ()
{
  DDRB |= (1 << PB0);

  // Initialise display and show startup logo

  spi_init ();
  ssd1306_init_display ();
  ssd1306_image_to_buffer (LOGO);
  ssd1306_show_display ();

  while (1)
    {
      PORTB ^= (1 << PB0);
      _delay_ms (350);
    }

}

